{% extends 'layouts/account-base.html' %}


{% block heading %}Криптовалютные балансы{% endblock %}


{% block heading_links %}
<a href="{{ url_for('page.crypto_balances_new') }}">Добавить крипто-баланс</a>
{% endblock %}


{% block content %}
<div class="mb-4">
  <div class="row">
    <div class="col-3 offset-9">
      <div class="d-flex">
        <div class="input-group input-group-sm">
          <div class="input-group-prepend">
            <span class="input-group-text"><i data-feather="plus"></i></span>
          </div>
          <input type="text" id="amount-addition-field" class="form-control form-control-sm" placeholder="0.00"
            value="0.00" readonly>
        </div>
        <button type="button" id="amount-addition-refresh" class="btn btn-sm btn-primary ml-1"><i
            data-feather="refresh-cw"></i></button>
      </div>
    </div>
  </div>
</div>

{% if crypto_balances %}
<div class="overflow-x-auto">
  <table class="table table-sm table-bordered table-hover m-0">
    <thead>
      <tr>
        <th>Название</th>
        <th>Код</th>
        <th>Сумма</th>
        <th>Сумма в USD</th>
        <th class="w-1 text-nowrap align-middle">
          <div class="d-flex align-items-center">
            <i data-feather="plus"></i>
            <input type="checkbox" id="amount-addition-all" class="ml-2">
          </div>
        </th>
        <th class="w-1"></th>
      </tr>
    </thead>
    <tbody>
      {% for b in crypto_balances %}
      <tr>
        <td>{{ b.name }}</td>
        <td>{{ b.symbol }}</td>
        <td>{{ b.amount_repr() }}</td>
        <td>{{ b.amount_usd_repr() }}</td>
        <td class="align-middle text-center">
          <div><input type="checkbox" class="ev__amount-addition" data-add-amount="{{ b.amount_usd_repr() }}"></div>
        </td>
        <td class="px-2 text-nowrap">
          <a href="{{ url_for('page.crypto_balance_edit', crypto_balance_id=b.id) }}"><i data-feather="edit"></i></a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}
{% endblock %}


{% block js %}
<script>
  let amountAdditionField = $('#amount-addition-field');
  let amountAdditionRefresh = $('#amount-addition-refresh');
  let amountAdditionEventCheckbox = $('.ev__amount-addition');
  let amountAdditionAll = $('#amount-addition-all');

  amountAdditionRefresh.on('click', function () {
    amountAdditionField.val('0.00');
    amountAdditionEventCheckbox.prop('checked', false);
    amountAdditionAll.prop('checked', false);
  });

  amountAdditionEventCheckbox.on('click', function () {
    let $this = $(this);
    let value = parseFloat(amountAdditionField.val());
    if ($this.prop('checked')) {
      value += parseFloat($this.attr('data-add-amount'));
    } else {
      value -= parseFloat($this.attr('data-add-amount'));
    }
    amountAdditionField.val(value.toFixed(2));
  });

  amountAdditionAll.on('click', function () {
    let $this = $(this);
    if (!$this.prop('checked')) {
      amountAdditionRefresh.trigger('click');
      return;
    }
    amountAdditionEventCheckbox.prop('checked', false);
    amountAdditionEventCheckbox.trigger('click');
  });
</script>
{% endblock %}