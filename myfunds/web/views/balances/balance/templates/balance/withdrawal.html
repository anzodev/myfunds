{% extends 'layouts/balance-page.html' %}


{% block content %}
<div class="card">

  <section class="p-3 border-bottom">
    <div class="lead">Withdrawal</div>
  </section>

  <section class="p-3">
    <form action="{{ url_for('balances.i.withdrawal', balance_id=g.balance.id) }}" method="POST">

      <div class="row">
        <div class="col-3">

          <div class="mb-3">
            <label for="amount" class="form-label small">Amount</label>
            <input type="text" name="amount" id="amount" class="form-control px-3"
              placeholder="{{ amount_placeholder }}" pattern="{{ amount_pattern }}" required>
          </div>

        </div>
        <div class="col-3">

          <div class="mb-3">
            <label for="category" class="form-label small">Category</label>
            <select name="category_id" id="category" class="form-control px-3">
              <option value="">No category</option>
              {% for category in categories %}
              <option value="{{ category.id }}">{{ category.name }}</option>
              {% endfor %}
            </select>
          </div>

        </div>
        <div class="col-6">

          <div class="mb-3">
            <label for="created-at" class="form-label small">Time</label>
            <div class="input-group">
              <input type="text" name="created_at" id="created-at" class="form-control px-3"
                data-mask="0000-00-00 00:00:00" required>
              <button id="toggle-created-at-ticker" class="btn btn-info disabled" type="button"><i
                  data-feather="play-circle" width="18" height="18"></i></button>
            </div>
          </div>

        </div>
      </div>

      <div class="mb-3">
        <label for="comment" class="form-label small">Comment (optional)</label>
        <input type="text" name="comment" id="comment" class="form-control px-3" placeholder="...">
      </div>

      <div>
        <button type="submit" class="btn btn-info">Withdraw</button>
      </div>

    </form>
  </section>

</div>
{% endblock %}


{% block js %}
<script>
  (function () {

    $('#created-at').daterangepicker({
      singleDatePicker: true,
      startDate: moment().format("YYYY-MM-DD HH:mm:ss"),
      locale: {
        format: 'YYYY-MM-DD HH:mm:ss'
      }
    });


    let createdAtField = $('#created-at');
    let toggleCreatedAtTicker = $('#toggle-created-at-ticker');

    function tickCreatedAt() {
      let time = moment().format("YYYY-MM-DD HH:mm:ss");
      createdAtField.data('daterangepicker').setStartDate(time);
      createdAtField.data('daterangepicker').setEndDate(time);
    }

    let createdAtTickInterval = setInterval(tickCreatedAt, 1000);

    createdAtField.on('show.daterangepicker', function () {
      clearInterval(createdAtTickInterval);
      $(toggleCreatedAtTicker).removeClass("disabled");
    });

    toggleCreatedAtTicker.on("click", function () {
      if (!$(this).hasClass("disabled")) {
        createdAtTickInterval = setInterval(tickCreatedAt, 1000);
        $(this).addClass("disabled");
      }
    });

  })();
</script>
{% endblock %}