{% extends 'layouts/balance-page.html' %}


{% block content %}
<div class="card">

  <section class="p-3 border-bottom">
    <div class="lead">Statistics</div>
  </section>

  <section class="p-3 mb-1">
    <div class="d-flex align-items-center">
      <div class="me-3">
        <form action="{{ url_for('balances.i.statistics', balance_id=g.balance.id, **request.args) }}">
          {% set year_filter_args = request.args.to_dict() %}
          {% set _ = year_filter_args.pop("year", None) %}
          {% for k,v in year_filter_args.items() %}
          <input type="hidden" name="{{ k }}" value="{{ v }}">
          {% endfor %}
          <select name="year" class="form-control" onchange="this.form.submit();">
            {% for year in filters.allowed_years %}
            <option value="{{ year }}" {% if year==filters.year %}selected{% endif %}>{{ year }}</option>
            {% endfor %}
          </select>
        </form>
      </div>
      <div class="btn-group flex-grow-1">
        {% set month_link_args = request.args.to_dict() %}
        {% set _ = month_link_args.pop("month", None) %}
        <a href="{{ url_for('balances.i.statistics', balance_id=g.balance.id, month=1, **month_link_args) }}"
          class="btn btn-info {% if 1 in filters.disabled_months %}disabled{% endif %} {% if 1 == filters.month %}active{% endif %}">Jan</a>
        <a href="{{ url_for('balances.i.statistics', balance_id=g.balance.id, month=2, **month_link_args) }}"
          class="btn btn-info {% if 2 in filters.disabled_months %}disabled{% endif %} {% if 2 == filters.month %}active{% endif %}">Feb</a>
        <a href="{{ url_for('balances.i.statistics', balance_id=g.balance.id, month=3, **month_link_args) }}"
          class="btn btn-info {% if 3 in filters.disabled_months %}disabled{% endif %} {% if 3 == filters.month %}active{% endif %}">Mar</a>
        <a href="{{ url_for('balances.i.statistics', balance_id=g.balance.id, month=4, **month_link_args) }}"
          class="btn btn-info {% if 4 in filters.disabled_months %}disabled{% endif %} {% if 4 == filters.month %}active{% endif %}">Apr</a>
        <a href="{{ url_for('balances.i.statistics', balance_id=g.balance.id, month=5, **month_link_args) }}"
          class="btn btn-info {% if 5 in filters.disabled_months %}disabled{% endif %} {% if 5 == filters.month %}active{% endif %}">May</a>
        <a href="{{ url_for('balances.i.statistics', balance_id=g.balance.id, month=6, **month_link_args) }}"
          class="btn btn-info {% if 6 in filters.disabled_months %}disabled{% endif %} {% if 6 == filters.month %}active{% endif %}">Jun</a>
        <a href="{{ url_for('balances.i.statistics', balance_id=g.balance.id, month=7, **month_link_args) }}"
          class="btn btn-info {% if 7 in filters.disabled_months %}disabled{% endif %} {% if 7 == filters.month %}active{% endif %}">Jul</a>
        <a href="{{ url_for('balances.i.statistics', balance_id=g.balance.id, month=8, **month_link_args) }}"
          class="btn btn-info {% if 8 in filters.disabled_months %}disabled{% endif %} {% if 8 == filters.month %}active{% endif %}">Aug</a>
        <a href="{{ url_for('balances.i.statistics', balance_id=g.balance.id, month=9, **month_link_args) }}"
          class="btn btn-info {% if 9 in filters.disabled_months %}disabled{% endif %} {% if 9 == filters.month %}active{% endif %}">Sep</a>
        <a href="{{ url_for('balances.i.statistics', balance_id=g.balance.id, month=10, **month_link_args) }}"
          class="btn btn-info {% if 10 in filters.disabled_months %}disabled{% endif %} {% if 10 == filters.month %}active{% endif %}">Oct</a>
        <a href="{{ url_for('balances.i.statistics', balance_id=g.balance.id, month=11, **month_link_args) }}"
          class="btn btn-info {% if 11 in filters.disabled_months %}disabled{% endif %} {% if 11 == filters.month %}active{% endif %}">Nov</a>
        <a href="{{ url_for('balances.i.statistics', balance_id=g.balance.id, month=12, **month_link_args) }}"
          class="btn btn-info {% if 12 in filters.disabled_months %}disabled{% endif %} {% if 12 == filters.month %}active{% endif %}">Dec</a>
      </div>
    </div>
  </section>


  <div class="row">
    <div class="col-8">

      <section class="p-3">
        <table class="table table-sm table-borderless shadow-none fs-6">
          <tbody>
            <tr>
              <td class="text-nowrap ps-0 py-1" style="width: 1px;">Start balance:</td>
              <td class="py-1">{% if general_stats.start_balance %}{{ hrf_amount(general_stats.start_balance,
                g.currency.precision) }}{%
                else %}-{% endif %}</td>
            </tr>
            <tr>
              <td class="text-nowrap ps-0 py-1" style="width: 1px;">Expense:</td>
              <td class="py-1">
                {% if general_stats.expense %}{{ hrf_amount(general_stats.expense, g.currency.precision) }}{% else %}-{%
                endif %}
                {% if general_stats.expense_pct %}({{ general_stats.expense_pct }}%){% endif %}
              </td>
            </tr>
            <tr>
              <td class="text-nowrap ps-0 py-1" style="width: 1px;">Income:</td>
              <td class="py-1">{% if general_stats.income %}{{ hrf_amount(general_stats.income, g.currency.precision)
                }}{%
                else %}-{%
                endif %}</td>
            </tr>
            <tr>
              <td class="text-nowrap ps-0 py-1" style="width: 1px;">End balance:</td>
              <td class="py-1">{% if general_stats.end_balance %}{{ hrf_amount(general_stats.end_balance,
                g.currency.precision) }}{% else
                %}-{% endif %}</td>
            </tr>
            <tr>
              <td class="text-nowrap ps-0 py-1" style="width: 1px;">Savings:</td>
              <td class="py-1">
                {% if general_stats.savings %}{{ hrf_amount(general_stats.savings, g.currency.precision) }}{% else %}-{%
                endif %}
                {% if general_stats.savings_pct %}({{ general_stats.savings_pct }}%){% endif %}
              </td>
            </tr>
          </tbody>
        </table>
      </section>

    </div>
    <div class="col-4">

      {% if month_progress %}
      <section class="p-3">
        <p class="text-end">Current day: <span class="fw-bold">{{ month_progress.current_day }}</span> ({{ month_progress.progress }}%)</p>
      </section>
      {% endif %}

    </div>
  </div>

  {% if expense_categories_stats %}
  <table class="table table-sm table-bordered shadow-none mb-0">
    <thead>
      <tr class="bg-light">
        <th colspan="6" class="text-center text-muted py-2 small border-start-0 border-end-0">Expense</th>
      </tr>
      <tr class="bg-light">
        <th class="align-middle text-center text-muted py-2 small border-start-0">Category</th>
        <th colspan="2" class="text-muted text-center py-2 small">Amount</th>
        <th colspan="2" class="text-nowrap text-center text-muted py-2 small">Limit</th>
        <th class="align-middle text-center text-muted py-2 small border-end-0">Expenses ratio</th>
      </tr>
    </thead>
    <tbody>
      {% for i in expense_categories_stats %}
      <tr class="hover:bg-light">
        <td class="align-middle text-nowrap border-start-0">
          <div class="d-flex">
            <div
              style="position: relative; top: 3px; width: 12px; height: 12px; border-radius: 50%; background-color: {{ i.color_sign }};">
            </div>
            <div class="ms-2"><a href="{{ i.href }}" class="link-info">{{ i.name }}</a></div>
          </div>
        </td>
        <td class="align-middle">{{ hrf_amount(i.amount, g.currency.precision) }}</td>
        <td class="align-middle">{{ i.amount_pct }}%</td>
        <td class="align-middle">...</td>
        <td class="align-middle">...</td>
        <td class="align-middle p-0 border-end-0">
          <div style="width: {{ i.amount_pct }}%; height: 38px; background-color: {{ i.color_sign }};">
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}

</div>
{% endblock %}


{% block js %}
<script>
  (function () {
    $('#f1-created-at-range').daterangepicker({
      autoApply: true,
      timePicker: true,
      timePicker24Hour: true,
      timePickerSeconds: true,
      showCustomRangeLabel: false,
      locale: {
        format: 'YYYY-MM-DD HH:mm:ss'
      }
    });
  })();
</script>
{% endblock %}